version: "3.8"
services:
    # JSON to C
    json2c:
        image: qmkfm/qmk_firmware
        working_dir: /qmk_firmware
        volumes:
            - ./keyboards:/qmk_firmware/keyboards
        environment:
            # Absolute path of the keymap json from QMK Configurator
            EXPORTED: /qmk_firmware/keyboards/helix/rev2/keymaps/custom/export.json
        # QMK Command: qmk json2c [-o OUTPUT] JSON_FILE
        command: /bin/bash -c 'qmk json2c -o $$(dirname $$EXPORTED)/keymaps_var.c $$EXPORTED'

    # Compile keymap.c to hex file
    compile:
        image: qmkfm/qmk_firmware
        working_dir: /qmk_firmware
        volumes:
            - ./keyboards:/qmk_firmware/keyboards
            - ./.build:/qmk_firmware/.build
        environment:
            KEYBOARD: helix
            KEYMAP: custom
        # QMK Command: qmk compile -kb KEYBOARD -km KEYMAP
        command: /bin/bash -c 'qmk compile -kb $$KEYBOARD -km $$KEYMAP'
